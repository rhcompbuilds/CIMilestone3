{% extends "base.html" %}
{% load static %}
{% load dict_extras %}

{% block title %}Timetable{% endblock %}

{% block content %}

{% for day_code, day_label in day_choices %}
<div class="day-page" data-day-index="{{ forloop.counter0 }}" {% if not forloop.first %}style="display:none;"{% endif %}>
  <h2>{{ day_label }}</h2>
  <table class="timetable" data-day="{{ day_code }}">
    <thead>
      <tr>
        <th>Time</th>
        <th>Activity</th>
        {% if user.is_superuser %}<th>Assign</th>{% endif %}
      </tr>
    </thead>
    <tbody>
      {% with day_slots=timetable_slots|get_item:day_label %}
      {% for time, _ in session_choices %}
      {% with session=day_slots|get_item:time %}
      <tr {% if session.activity and session.activity.activity_name == 'Lunch' %}class="lunch-row"{% endif %}>
        <td>{{ time }}</td>
        <td data-time="{{ time }}">
          {% if session.activity %}
            {{ session.activity.activity_name }}
          {% else %}
            -
          {% endif %}
        </td>
        {% if user.is_superuser %}
        <td>
          <button 
            class="add-activity-btn" 
            data-day="{{ day_code }}" 
            data-time="{{ time }}">
            {% if session.activity and session.activity.activity_name == 'Lunch' %}hidden{% endif %}
            Add Activity
          </button>
        </td>
        {% endif %}
      </tr>
      {% endwith %}
      {% endfor %}
      {% endwith %}
    </tbody>
  </table>
  <div class="navigation">
    <button class="prevBtn">Previous Day</button>
    <button class="nextBtn">Next Day</button>
  </div>
</div>
{% endfor %}

<!-- Activity Modal -->
<div id="activityModal" class="modal">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>
    <h3>Select Activity</h3>
    <input type="hidden" id="modalDay">
    <input type="hidden" id="modalTime">
    <select id="activitySelect">
      <option value="">-- Choose Activity --</option>
      {% for activity in activities %}
      <option value="{{ activity.id }}">{{ activity.activity_name }}</option>
      {% endfor %}
    </select>
    <button id="assignActivityBtn">Assign Activity</button>
  </div>
</div>

{% endblock %}
{% block extra_js %}
<script src="{% static 'js/booking_modal.js' %}" crossorigin="use-credentials"></script>
{% endblock %}

